<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Documentation & GitHub Quiz Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex items-center justify-center p-4">

<div id="app" class="w-full max-w-2xl">
    <div class="glass border border-slate-200 rounded-3xl shadow-xl overflow-hidden min-h-[550px] flex flex-col">

        <!-- Header -->
        <div class="bg-indigo-600 p-6 text-white flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold">AI ë¬¸ì„œ & ê¹ƒí—ˆë¸Œ í€´ì¦ˆ</h1>
                <p class="text-indigo-100 text-sm">URLì„ ë¶„ì„í•˜ì—¬ í•µì‹¬ ë‚´ìš©ì„ í€´ì¦ˆë¡œ ë§Œë“­ë‹ˆë‹¤</p>
            </div>
            <div id="progress-text" class="text-sm font-semibold hidden">ë¬¸ì œ 1 / 10</div>
        </div>

        <!-- Progress Bar -->
        <div class="w-full bg-slate-100 h-1 hidden" id="progress-bar-container">
            <div id="progress-bar" class="bg-indigo-400 h-full transition-all duration-300" style="width: 0%"></div>
        </div>

        <!-- Content Area -->
        <div id="content" class="p-8 flex-grow flex flex-col">

            <!-- URL Input Screen -->
            <div id="setup-screen" class="space-y-6 my-auto text-center">
                <div class="bg-indigo-50 w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                    </svg>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">ê³µì‹ ë¬¸ì„œë‚˜ GitHub ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”</h2>
                    <p class="text-slate-500 text-sm mt-1">GitHubì˜ ê²½ìš° READMEì™€ ë§í¬ëœ í•µì‹¬ ê°œë…ì„ ê¹Šì´ ìˆê²Œ íŒŒê³ ë“­ë‹ˆë‹¤.</p>
                </div>

                <div class="space-y-3">
                    <input type="text" id="doc-url" placeholder="ì˜ˆ: https://github.com/vavr-io/vavr"
                           class="w-full p-4 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none transition-all"
                           value="">
                    <button id="generate-btn" onclick="generateQuiz()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-8 rounded-xl transition-all shadow-lg flex items-center justify-center gap-3">
                        <span>í€´ì¦ˆ ìƒì„± ì‹œì‘</span>
                    </button>
                </div>
            </div>

            <!-- Loading Screen -->
            <div id="loading-screen" class="hidden space-y-6 my-auto text-center">
                <div class="flex justify-center"><div class="loader w-12 h-12 border-t-indigo-600"></div></div>
                <p class="text-slate-600 font-medium" id="loading-status">ë¬¸ì„œ ë¶„ì„ ì¤‘...</p>
                <p class="text-xs text-slate-400" id="loading-sub">AIê°€ ë§ˆí¬ë‹¤ìš´ì„ ë¶„ì„í•˜ê³  í•˜ìœ„ ë§í¬ë“¤ì„ íƒìƒ‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
            </div>

            <!-- Quiz Screen -->
            <div id="quiz-screen" class="hidden space-y-6">
                <h3 id="question-text" class="text-xl font-bold text-slate-800 leading-tight min-h-[3rem]"></h3>
                <div id="options-container" class="space-y-3"></div>
            </div>

            <!-- Result Screen -->
            <div id="result-screen" class="hidden space-y-6 overflow-y-auto max-h-[600px] pr-2">
                <div class="text-center pb-6 border-b border-slate-100">
                    <h2 class="text-3xl font-bold text-slate-800 mb-2">í•™ìŠµ ë¦¬í¬íŠ¸</h2>
                    <div class="text-5xl font-black text-indigo-600 mb-4" id="final-score">0 / 0</div>
                    <button onclick="location.reload()" class="bg-indigo-50 text-indigo-600 font-bold py-2 px-6 rounded-lg hover:bg-indigo-100 transition-all">ë‹¤ë¥¸ ë¬¸ì„œ í•™ìŠµí•˜ê¸°</button>
                </div>
                <div id="explanations-container" class="space-y-6 pt-4"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // API KeyëŠ” ì‹¤í–‰ í™˜ê²½ì—ì„œ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
    const apiKey = "";

    let quizData = [];
    let currentQuestion = 0;
    let score = 0;
    let userAnswers = [];

    // GitHub Repositoryì˜ README ë‚´ìš©ì„ ì§ì ‘ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    async function fetchGitHubReadme(url) {
        try {
            const match = url.match(/github\.com\/([^\/]+)\/([^\/]+)/);
            if (!match) return null;
            const owner = match[1];
            const repo = match[2].replace('.git', '');

            const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/readme`, {
                headers: { 'Accept': 'application/vnd.github.v3.raw' }
            });
            if (response.ok) {
                return await response.text();
            }
        } catch(e) {
            console.warn("GitHub API fetch failed:", e);
        }
        return null;
    }

    async function callGeminiAPI(url, readmeContent) {
        const isGitHub = url.toLowerCase().includes("github.com");

        const systemPrompt = `ë‹¹ì‹ ì€ ì‹œë‹ˆì–´ ê°œë°œìì´ì ê¸°ìˆ  ë©˜í† ì…ë‹ˆë‹¤.
ë‹¹ì‹ ì˜ ëª©í‘œëŠ” ì‚¬ìš©ìê°€ ì œê³µí•œ ê¸°ìˆ  ë¬¸ì„œ(ë˜ëŠ” GitHub ì €ì¥ì†Œ)ì˜ ê²‰í•¥ê¸°ì‹ ë‚´ìš©ì´ ì•„ë‹Œ, ê¹Šì´ ìˆëŠ” ì‘ë™ ì›ë¦¬ì™€ í•µì‹¬ ê°œë…ì„ í™•ì‹¤íˆ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ê³ í’ˆì§ˆì˜ í€´ì¦ˆë¥¼ ì¶œì œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
ê° ë¬¸ì œëŠ” 4ê°œì˜ ì„ íƒì§€ë¥¼ ê°€ì§€ë©°, 1ê°œì˜ ì •ë‹µ ì¸ë±ìŠ¤(0-3)ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
ê° ë¬¸ì œë§ˆë‹¤ ì´ ë‚´ìš©ì´ ì™œ ì¤‘ìš”í•œì§€, ì‹¤ë¬´ì—ì„œ ì–´ë–»ê²Œ ì“°ì´ëŠ”ì§€ ë“±ì„ í¬í•¨í•œ ìƒì„¸í•œ í•™ìŠµ í•´ì„¤(rationale)ì„ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”.`;

        let userPrompt = `ë‹¤ìŒ ëŒ€ìƒ URLì„ ê¸°ë°˜ìœ¼ë¡œ 10ë¬¸í•­ì˜ í€´ì¦ˆë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”: ${url}\n\n`;

        if (isGitHub) {
            userPrompt += `[íŠ¹ë³„ ìš”ì²­ì‚¬í•­: GitHub ì‹¬ì¸µ ë¶„ì„]
1. ì´ ì €ì¥ì†Œì˜ ë‹¨ìˆœí•œ íŒŒì¼ ìœ„ì¹˜ë‚˜ ì„¤ì¹˜ ëª…ë ¹ì–´ ê°™ì€ 'ì“¸ë°ì—†ê³  ì§€ì—½ì ì¸ ì§ˆë¬¸'ì€ ì ˆëŒ€ ë‚´ì§€ ë§ˆì„¸ìš”.
2. ë§ˆí¬ë‹¤ìš´ ë‚´ì— ë§í¬ëœ í•˜ìœ„ ë¬¸ì„œ(Architecture, Docs, Guide ë“±)ë“¤ì˜ ë‚´ìš©ì„ ë‹¹ì‹ ì˜ ë°©ëŒ€í•œ ì§€ì‹ì„ ë°”íƒ•ìœ¼ë¡œ íƒìƒ‰í•˜ê³  ìœ ì¶”í•˜ì—¬, ê·¸ ì €ì¥ì†Œë¥¼ êµ¬ì„±í•˜ëŠ” í•µì‹¬ ì›ë¦¬, ë””ìì¸ íŒ¨í„´, ì£¼ìš” ëª¨ë“ˆì˜ ì—­í• ì„ ë¬»ëŠ” ë¬¸ì œë¥¼ ì¶œì œí•˜ì„¸ìš”. ëœë¤ìœ¼ë¡œ ê¹Šì´ ìˆëŠ” ì£¼ì œë“¤ì„ ì„ ì •í•˜ì„¸ìš”.
3. ìš°ë¦¬ê°€ ì´ í”„ë¡œì íŠ¸ì˜ ì•„í‚¤í…ì²˜ì™€ í•µì‹¬ ê°€ì¹˜ë¥¼ ëª…í™•íˆ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì§ˆë¬¸ì„ êµ¬ì„±í•´ì£¼ì„¸ìš”.\n\n`;

            if (readmeContent) {
                // í”„ë¡¬í”„íŠ¸ ê¸¸ì´ ì œí•œì„ ê³ ë ¤í•´ ë§ˆí¬ë‹¤ìš´ ë‚´ìš©ì€ ìµœëŒ€ 15000ìë¡œ ìë¦„
                userPrompt += `[ì°¸ê³ ìš© ì‹¤ì œ ë§ˆí¬ë‹¤ìš´ ë‚´ìš© (ì´ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ í™•ì¥í•˜ì—¬ ì§ˆë¬¸ì„ ìƒì„±í•˜ì„¸ìš”)]\n${readmeContent.substring(0, 15000)}\n`;
            }
        } else {
            userPrompt += `ë‹¨ìˆœí•œ í‘œë©´ì  ë‚´ìš©ë³´ë‹¤ëŠ” ì—°ê²°ëœ í•µì‹¬ ê°œë…, ì•„í‚¤í…ì²˜, ì‘ë™ ì›ë¦¬ ë“± ìš°ë¦¬ê°€ ì´ ê¸°ìˆ ì„ ê¹Šì´ ìˆê²Œ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” ë¬¸ì œë¥¼ ì¶œì œí•´ ì£¼ì„¸ìš”. ì“¸ë°ì—†ëŠ” ì§ˆë¬¸ì€ ë°°ì œí•˜ì„¸ìš”.\n`;
        }

        const payload = {
            contents: [{ parts: [{ text: userPrompt }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
            // 401 ì˜¤ë¥˜ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ google_search ë„êµ¬ëŠ” ì œê±°ë¨
            generationConfig: {
                responseMimeType: "application/json",
                responseSchema: {
                    type: "OBJECT",
                    properties: {
                        questions: {
                            type: "ARRAY",
                            items: {
                                type: "OBJECT",
                                properties: {
                                    question: { type: "STRING" },
                                    options: { type: "ARRAY", items: { type: "STRING" }, minItems: 4, maxItems: 4 },
                                    answer: { type: "NUMBER" },
                                    rationale: { type: "STRING" }
                                },
                                required: ["question", "options", "answer", "rationale"]
                            }
                        }
                    },
                    required: ["questions"]
                }
            }
        };

        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        const fetchWithRetry = async (retries = 5) => {
            const delays = [1000, 2000, 4000, 8000, 16000];
            for (let i = 0; i <= retries; i++) {
                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                        if (!text) throw new Error("AI ì‘ë‹µì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");
                        return JSON.parse(text);
                    }

                    if (response.status === 401) {
                        console.warn(`[${i+1}ì°¨ ì‹œë„] 401 ì¸ì¦ ì—ëŸ¬ ë°œìƒ. í™˜ê²½ ë™ê¸°í™” ëŒ€ê¸° ì¤‘...`);
                        if (i === retries) {
                            throw new Error("401 Unauthorized: í˜„ì¬ ì‹œìŠ¤í…œì˜ API ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìš°ì¸¡ ìº”ë²„ìŠ¤ ì°½ì„ ìƒˆë¡œê³ ì¹¨ í•œ ë’¤ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                        }
                    } else if (!response.ok && i === retries) {
                        throw new Error(`API í†µì‹  ì˜¤ë¥˜ (ìƒíƒœ ì½”ë“œ: ${response.status})`);
                    }

                } catch (err) {
                    if (i === retries) throw err;
                }
                if (i < retries) await new Promise(res => setTimeout(res, delays[i]));
            }
        };

        return await fetchWithRetry();
    }

    async function generateQuiz() {
        const urlInput = document.getElementById('doc-url').value.trim();
        if (!urlInput) {
            alert("URLì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
            return;
        }

        document.getElementById('setup-screen').classList.add('hidden');
        document.getElementById('loading-screen').classList.remove('hidden');

        let readmeContent = null;
        if (urlInput.toLowerCase().includes("github.com")) {
            document.getElementById('loading-status').innerText = "GitHub ì €ì¥ì†Œ ë¶„ì„ ì¤‘...";
            document.getElementById('loading-sub').innerText = "ì €ì¥ì†Œì˜ READMEë¥¼ ì½ì–´ì˜¤ê³  ë§í¬ëœ ì£¼ìš” ê°œë…ì„ íƒìƒ‰í•©ë‹ˆë‹¤.";
            readmeContent = await fetchGitHubReadme(urlInput);
        } else {
            document.getElementById('loading-status').innerText = "ë¬¸ì„œ ë¶„ì„ ì¤‘...";
            document.getElementById('loading-sub').innerText = "ë¬¸ì„œì˜ í•µì‹¬ ê°œë…ì„ íŒŒì•…í•˜ì—¬ í€´ì¦ˆë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.";
        }

        try {
            const result = await callGeminiAPI(urlInput, readmeContent);
            quizData = result.questions || [];
            if (quizData.length === 0) throw new Error("ë¬¸ì œë¥¼ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
            startQuiz();
        } catch (error) {
            console.error(error);
            document.getElementById('loading-screen').innerHTML = `
                    <div class="space-y-4">
                        <div class="bg-red-50 p-4 rounded-xl border border-red-200">
                            <p class="text-red-600 font-bold mb-1">í€´ì¦ˆ ìƒì„± ì˜¤ë¥˜</p>
                            <p class="text-xs text-red-500 break-all font-mono">${error.message}</p>
                        </div>
                        <p class="text-xs text-slate-500">â€» ì‹œìŠ¤í…œ ì„¸ì…˜ ë¬¸ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ì¸¡ íƒ­ì„ ìƒˆë¡œê³ ì¹¨ í›„ ì‹œë„í•´ë³´ì„¸ìš”.</p>
                        <button onclick="location.reload()" class="w-full bg-indigo-600 text-white py-3 px-6 rounded-xl font-bold shadow-lg">ë‹¤ì‹œ ì‹œë„</button>
                    </div>
                `;
        }
    }

    function startQuiz() {
        document.getElementById('loading-screen').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');
        document.getElementById('progress-bar-container').classList.remove('hidden');
        document.getElementById('progress-text').classList.remove('hidden');
        loadQuestion();
    }

    function loadQuestion() {
        const q = quizData[currentQuestion];
        document.getElementById('question-text').innerText = `${currentQuestion + 1}. ${q.question}`;
        document.getElementById('progress-text').innerText = `ë¬¸ì œ ${currentQuestion + 1} / ${quizData.length}`;
        document.getElementById('progress-bar').style.width = `${((currentQuestion) / quizData.length) * 100}%`;

        const container = document.getElementById('options-container');
        container.innerHTML = '';

        q.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = "w-full text-left p-4 rounded-xl border border-slate-200 hover:border-indigo-500 hover:bg-indigo-50 transition-all group flex items-start gap-3";
            btn.innerHTML = `
                    <span class="flex-shrink-0 w-6 h-6 rounded-full bg-slate-100 group-hover:bg-indigo-200 text-slate-500 group-hover:text-indigo-700 text-xs font-bold flex items-center justify-center">
                        ${index + 1}
                    </span>
                    <span class="text-slate-700 group-hover:text-indigo-900">${opt}</span>
                `;
            btn.onclick = () => selectOption(index);
            container.appendChild(btn);
        });
    }

    function selectOption(index) {
        userAnswers.push(index);
        if (index === quizData[currentQuestion].answer) score++;

        if (currentQuestion < quizData.length - 1) {
            currentQuestion++;
            loadQuestion();
        } else {
            showResults();
        }
    }

    function showResults() {
        document.getElementById('quiz-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('progress-bar').style.width = '100%';
        document.getElementById('progress-text').innerText = 'í•™ìŠµ ì™„ë£Œ';
        document.getElementById('final-score').innerText = `${score} / ${quizData.length}`;

        const container = document.getElementById('explanations-container');
        container.innerHTML = '<h4 class="font-bold text-lg text-slate-700 mb-4">ìƒì„¸ í•´ì„¤ ë° ì‹¤ë¬´ ì¸ì‚¬ì´íŠ¸</h4>';

        quizData.forEach((q, i) => {
            const isCorrect = userAnswers[i] === q.answer;
            const div = document.createElement('div');
            div.className = `p-5 rounded-2xl border ${isCorrect ? 'border-green-100 bg-green-50/30' : 'border-red-100 bg-red-50/30'}`;
            div.innerHTML = `
                    <div class="flex items-start gap-2 mb-2">
                        <span class="mt-1 text-sm font-bold ${isCorrect ? 'text-green-600' : 'text-red-600'} flex-shrink-0">
                            ${isCorrect ? 'âœ“' : 'âœ—'}
                        </span>
                        <h5 class="font-bold text-slate-800">${i + 1}. ${q.question}</h5>
                    </div>
                    <div class="text-sm space-y-1 ml-6">
                        <p class="text-slate-600"><span class="font-semibold text-xs uppercase">Your:</span> ${q.options[userAnswers[i]]}</p>
                        ${!isCorrect ? `<p class="text-indigo-600"><span class="font-semibold text-xs uppercase">Correct:</span> ${q.options[q.answer]}</p>` : ''}
                        <div class="mt-3 pt-3 border-t border-slate-200/50 text-slate-700 italic">
                            <span class="not-italic font-bold text-indigo-600">ğŸ’¡ ë©˜í† ì˜ í•´ì„¤:</span> ${q.rationale}
                        </div>
                    </div>
                `;
            container.appendChild(div);
        });
    }
</script>
</body>
</html>